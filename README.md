## –ê–≤—Ç–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞:
**–í–æ–ª–∫–æ–≤ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä** ‚Äî [https://t.me/ximikat01](https://t.me/ximikat01)


# BIGS ‚Äî –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π –ø–æ—Ä—Ç—Ñ–µ–ª—å (Frontend + FastAPI)

–ù–µ–±–æ–ª—å—à–æ–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –≤–µ–¥–µ–Ω–∏—è –ª–∏—á–Ω–æ–≥–æ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø–æ—Ä—Ç—Ñ–µ–ª—è: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–ª–æ–≥–∏–Ω (JWT), —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª–µ–π, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π, –≥—Ä–∞—Ñ–∏–∫–∏, –∫–æ—Ç–∏—Ä–æ–≤–∫–∏ –∏ —Å–≤–µ—á–∏ —á–µ—Ä–µ–∑ Tinkoff Invest API. –§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Äî –Ω–∞ —á–∏—Å—Ç–æ–º HTML/JS/CSS, –±—ç–∫–µ–Ω–¥ ‚Äî FastAPI + SQLAlchemy + PostgreSQL. 

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥ (JWT), —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤ `localStorage`  
- –ü–æ—Ä—Ç—Ñ–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: —Å–æ–∑–¥–∞–Ω–∏–µ, —Å–ø–∏—Å–æ–∫, –ø–æ–∑–∏—Ü–∏–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–æ–≤: –∞–∫—Ü–∏–∏, –æ–±–ª–∏–≥–∞—Ü–∏–∏, —Ñ–æ–Ω–¥—ã, –∞ —Ç–∞–∫–∂–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è ¬´–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å—á—ë—Ç–∞¬ª
- –†–µ—Ñ—Ä–µ—à –∫–æ—Ç–∏—Ä–æ–≤–æ–∫ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤ (Chart.js)
- –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è (–ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ)
- –°–≤–µ—á–∏ –ø–æ FIGI –∑–∞ –ø–µ—Ä–∏–æ–¥—ã 1D/1W/1M/1Y
- –†–µ–∑–æ–ª–≤ —Ç–∏–∫–µ—Ä–∞ ‚Üí FIGI / –∫–ª–∞—Å—Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
- –ì–æ—Ç–æ–≤—ã–π Docker Compose (Postgres + –±—ç–∫–µ–Ω–¥ + Nginx –¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞)

---

## –°—Ç–µ–∫

- **Backend:** FastAPI, SQLAlchemy, Pydantic, jose (JWT), Tinkoff Invest SDK  
- **DB:** PostgreSQL 16  
- **Frontend:** HTML + CSS + JS (axios, Chart.js, Flatpickr)  
- **Runtime:** Docker Compose (3 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)  

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–æ—Å–Ω–æ–≤–Ω–æ–µ)

```
app/
  backend/
    ... (FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
  frontend/
    index.html     # –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç (–ø–æ—Ä—Ç—Ñ–µ–ª—å)
    login.html     # –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
env/
  backend/Dockerfile
  pgsql/          # init/migrations
  localtime
docker-compose.yml
.env              
```

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Docker)

### 1) –°–æ–∑–¥–∞–π—Ç–µ `.env` –≤ –∫–æ—Ä–Ω–µ
–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è. –ù–∏–∂–µ –ø—Ä–∏–º–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ —Å–µ–±—è.

```ini
# --- Project ---
COMPOSE_PROJECT_NAME=bigs

TZ=Europe/Moscow
APP_PORT=8080              # –ø–æ—Ä—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (Nginx)
BACKEND_PORT=8000          # –≤–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç –±—ç–∫–µ–Ω–¥–∞

# --- DB ---
POSTGRES_USER=bigs
POSTGRES_PASSWORD=bigs_pass
POSTGRES_DB=bigsdb
POSTGRES_PORT=5432

# JDBC/SQLAlchemy DSN (–í–∞–∂–Ω–æ: —Å—Ö–µ–º–∞ pf —Å–æ–∑–¥–∞–µ—Ç—Å—è init-—Å–∫—Ä–∏–ø—Ç–æ–º)
DATABASE_URL=postgresql+psycopg2://bigs:bigs_pass@db:5432/bigsdb

# --- Auth ---
SECRET_KEY=dev_secret_key_please_change
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=60

# --- CORS ---
ALLOWED_ORIGINS=http://localhost:8080,http://127.0.0.1:8080

# --- Market --- (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –∫–æ—Ç–∏—Ä–æ–≤–æ–∫/—Å–≤–µ—á–µ–π)
TINKOFF_TOKEN=your_tinkoff_invest_api_token_here
```

> –ï—Å–ª–∏ TINKOFF_TOKEN –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω, –∫–æ—Ç–∏—Ä–æ–≤–∫–∏ –∏ —Å–≤–µ—á–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –∏ ¬´–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å—á—ë—Ç–∞¬ª —Ä–∞–±–æ—Ç–∞–µ—Ç.

### 2) –ó–∞–ø—É—Å—Ç–∏—Ç–µ Docker Compose
```bash
docker compose up -d --build
```

–ë—É–¥—É—Ç –ø–æ–¥–Ω—è—Ç—ã:
- **bigs-db** ‚Äî PostgreSQL –Ω–∞ `localhost:5432`
- **bigs-backend** ‚Äî FastAPI –Ω–∞ `http://localhost:8000`
- **bigs-frontend** ‚Äî Nginx, —Ä–∞–∑–¥–∞—ë—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–∞ `http://localhost:8080`

### 3) –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä
- –§—Ä–æ–Ω—Ç–µ–Ω–¥: **http://localhost:8080/login.html**  
- –ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ‚Äî —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ **index.html** (–ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç).

---

## –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è (–±—Ä–∞—É–∑–µ—Ä)

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `/login.html`, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å (email/–ø–∞—Ä–æ–ª—å), –∑–∞—Ç–µ–º –≤–æ–π–¥–∏—Ç–µ.  
2. –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ —Ç–æ–∫–µ–Ω/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ `localStorage`, –≤—ã –æ–∫–∞–∂–µ—Ç–µ—Å—å –Ω–∞ `/index.html`.
3. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–∞–±–∏–Ω–µ—Ç–∞:
   - –ö–Ω–æ–ø–∫–∞ ¬´–î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤¬ª: –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø, –≤–≤–µ–¥–∏—Ç–µ —Ç–∏–∫–µ—Ä (–¥–ª—è –±—É–º–∞–≥), –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Ü–µ–Ω—É –∏ –¥–∞—Ç—É.
   - –î–ª—è –±—É–º–∞–≥ —Ç–∏–∫–µ—Ä —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è –≤ FIGI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.  
   - –ö–Ω–æ–ø–∫–∞ ¬´–û–±–Ω–æ–≤–∏—Ç—å¬ª –ø–æ–¥—Ç—è–Ω–µ—Ç —Ç–µ–∫—É—â–∏–µ –∫–æ—Ç–∏—Ä–æ–≤–∫–∏ –¥–ª—è –≤—Å–µ—Ö –±—É–º–∞–≥ –ø–æ—Ä—Ç—Ñ–µ–ª—è.
   - –ù–∞–∂–º–∏—Ç–µ ¬´üìà –ì—Ä–∞—Ñ–∏–∫¬ª —É –ø–æ–∑–∏—Ü–∏–∏, —á—Ç–æ–±—ã —Ä–∞—Å–∫—Ä—ã—Ç—å —Å–≤–æ–¥–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ —Å –ø–µ—Ä–∏–æ–¥–∞–º–∏ (1D/1W/1M/1Y).
   - ¬´‚ú® –ú–æ–π –ø–æ—Ä—Ç—Ñ–µ–ª—å¬ª ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ.
   - ¬´üö™ –í—ã–π—Ç–∏¬ª ‚Äî –æ—á–∏—Å—Ç–∏—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏ –≤–µ—Ä–Ω—ë—Ç –Ω–∞ `/login.html`.

---

## API (–∫–æ—Ä–æ—Ç–∫–æ)

–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (–∫—Ä–æ–º–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –ª–æ–≥–∏–Ω–∞) ‚Äî –ø–æ–¥ `Bearer <token>`.

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `POST /users` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
  **Body:** `{ "email": "...", "password": "...", "phone": "..." }`  
- `POST /auth/login` ‚Äî –≤—Ö–æ–¥  
  **Body:** `{ "email": "...", "password": "..." }` ‚Üí `{ "access_token": "...", "user_id": 1 }`

### –ü–æ—Ä—Ç—Ñ–µ–ª—å
- `GET /portfolio` ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ—Ä—Ç—Ñ–µ–ª–µ–π —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
- `POST /portfolio` ‚Äî —Å–æ–∑–¥–∞—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—å `{ "title":"–û—Å–Ω–æ–≤–Ω–æ–π","type":"broker","currency":"RUB" }`
- `GET /portfolio/{id}/positions` ‚Äî –ø–æ–∑–∏—Ü–∏–∏ (–∫–æ—Ä–æ—Ç–∫–æ)  
- `GET /portfolio/{id}/positions/full` ‚Äî –ø–æ–∑–∏—Ü–∏–∏ + –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç  
- `POST /portfolio/positions` ‚Äî —Å–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é  
  ```json
  {
    "portfolio_id": 1,
    "ticker": "SBER",
    "class_hint": "share",       // share | bond | etf
    "figi": "BBG004730N88",
    "quantity": 10,
    "avg_price": 250.00,
    "name": "–°–±–µ—Ä–±–∞–Ω–∫",
    "currency": "RUB",
    "nominal": null
  }
  ```
- `DELETE /portfolio/positions/{position_id}` ‚Äî —É–¥–∞–ª–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é

### –†—ã–Ω–æ–∫ (Tinkoff)
- `GET /resolve?ticker=SBER` ‚Äî –≤–∞—Ä–∏–∞–Ω—Ç—ã FIGI –¥–ª—è —Ç–∏–∫–µ—Ä–∞  
- `GET /quote/{figi}` ‚Äî –ø–æ—Å–ª–µ–¥–Ω—è—è —Ü–µ–Ω–∞ (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ, —Å —É—á—ë—Ç–æ–º –∫–ª–∞—Å—Å–∞)
- `GET /candles/{figi}?interval=1d&from_=ISO&to=ISO` ‚Äî —Å–≤–µ—á–∏
- `POST /quotes_by_tickers` ‚Äî –ø–∞–∫–µ—Ç –∫–æ—Ç–∏—Ä–æ–≤–æ–∫ –ø–æ —Ç–∏–∫–µ—Ä–∞–º  
  ```json
  { "tickers": ["SBER","TCSG"], "class_hint": "share" }
  ```

---

## –ü—Ä–∏–º–µ—Ä—ã `curl`

```bash
# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
curl -X POST http://localhost:8000/users \
  -H "Content-Type: application/json" \
  -d '{"email":"user@example.com","password":"secret"}'

# –í—Ö–æ–¥
curl -X POST http://localhost:8000/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"user@example.com","password":"secret"}'
# ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ access_token –∏–∑ –æ—Ç–≤–µ—Ç–∞
TOKEN="PASTE_TOKEN_HERE"

# –°–æ–∑–¥–∞—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—å
curl -X POST http://localhost:8000/portfolio \
  -H "Authorization: Bearer ${TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{"title":"–û—Å–Ω–æ–≤–Ω–æ–π","type":"broker","currency":"RUB"}'

# –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª–∏
curl -s http://localhost:8000/portfolio \
  -H "Authorization: Bearer ${TOKEN}" | jq

# –†–µ–∑–æ–ª–≤ FIGI –¥–ª—è —Ç–∏–∫–µ—Ä–∞
curl -s "http://localhost:8000/resolve?ticker=SBER" | jq

# –ö–æ—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ FIGI
curl -s http://localhost:8000/quote/BBG004730N88 | jq

# –î–æ–±–∞–≤–∏—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é
curl -X POST http://localhost:8000/portfolio/positions \
  -H "Authorization: Bearer ${TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "portfolio_id": 1,
    "ticker": "SBER",
    "class_hint": "share",
    "figi": "BBG004730N88",
    "quantity": 3,
    "avg_price": 317
  }'

# –ü–æ–∑–∏—Ü–∏–∏ (–ø–æ–ª–Ω—ã–µ)
curl -s http://localhost:8000/portfolio/1/positions/full \
  -H "Authorization: Bearer ${TOKEN}" | jq

# –°–≤–µ—á–∏
curl -s "http://localhost:8000/candles/BBG004730N88?interval=1d" | jq
```

---

## –ü–æ–ª–µ–∑–Ω—ã–µ –∞–¥—Ä–µ—Å–∞
- –§—Ä–æ–Ω—Ç–µ–Ω–¥: **http://localhost:8080/**
  - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞: `/login.html`
  - –ö–∞–±–∏–Ω–µ—Ç: `/index.html`
- –ë—ç–∫–µ–Ω–¥ (Swagger): **http://localhost:8000/docs**

---

## Dev –±–µ–∑ Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ë—ç–∫–µ–Ω–¥
```bash
python -m venv venv
source venv/bin/activate   # Windows: venv\Scripts\activate
pip install -r requirements.txt
export DATABASE_URL="postgresql+psycopg2://bigs:bigs_pass@localhost:5432/bigsdb"
export ALLOWED_ORIGINS="http://localhost:8080"
export SECRET_KEY="dev_secret"
export TINKOFF_TOKEN="..."   # –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏

uvicorn app.backend.main:app --reload --host 0.0.0.0 --port 8000
```

### –§—Ä–æ–Ω—Ç–µ–Ω–¥
–õ—é–±–æ–π —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–µ—Ä–≤–µ—Ä, –Ω–∞–ø—Ä–∏–º–µ—Ä:
```bash
python -m http.server 8080 -d app/frontend
```
–û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:8080/login.html`.

---

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ü–∞—Ä–∞–º–µ—Ç—Ä `ALLOWED_ORIGINS` –¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å –∞–¥—Ä–µ—Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `http://localhost:8080`).  
- –°—Ö–µ–º–∞ –ë–î `pf` —Å–æ–∑–¥–∞—ë—Ç—Å—è init-—Å–∫—Ä–∏–ø—Ç–æ–º `env/pgsql/initdb.sql`.  
- –î–ª—è –∫–æ—Ç–∏—Ä–æ–≤–æ–∫/—Å–≤–µ—á–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º —Ä–∞–±–æ—á–∏–π `TINKOFF_TOKEN`.  

–£–¥–∞—á–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏! üöÄ
