/* HEADER: same size as Investments, but not sticky */
:root{ --header-h: 56px; }
.app-header{
  /* визуал и размеры как на вкладке Инвестиции */
  display:flex; align-items:center; justify-content:space-between; gap:12px;
  height: var(--header-h);
  padding: 0 clamp(10px,1.6vw,14px);
  backdrop-filter:saturate(1.2) blur(6px);
  background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
  border:1px solid var(--stroke);
  border-radius: clamp(10px,1.8vw,14px);
  box-shadow: var(--shadow);
}
/* отключаем «липкость» и любые top/margin от глобального стиля */
.app-header--static{
  position: static !important;
  top: auto !important;
  margin-top: 0 !important;
}
/* чтобы глобальный selector header{} из style.css не навесил sticky */
header.app-header{ position: static !important; }

/* Бюджет — визуал в стиле портфеля */
.budget-page{
  display:flex;
  flex-direction:column;
  gap:16px;
  font-variant-numeric: tabular-nums lining-nums;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}

:root{
  --safe-top: env(safe-area-inset-top);
  --safe-bottom: env(safe-area-inset-bottom);
  --safe-left: env(safe-area-inset-left);
  --safe-right: env(safe-area-inset-right);
}

/* ===== Obligations toggle – responsive sizes ===== */
:root{
  --ob-toggle-w: 52px;
  --ob-toggle-h: 30px;
  --ob-toggle-pad: 3px;
  --ob-toggle-knob: calc(var(--ob-toggle-h) - var(--ob-toggle-pad)*2);
  --ob-toggle-shift: calc(var(--ob-toggle-w) - var(--ob-toggle-h));
}
@media (max-width:480px){
  :root{
    --ob-toggle-w: 44px;
    --ob-toggle-h: 26px;
    --ob-toggle-pad: 3px;
    --ob-toggle-knob: calc(var(--ob-toggle-h) - var(--ob-toggle-pad)*2);
    --ob-toggle-shift: calc(var(--ob-toggle-w) - var(--ob-toggle-h));
  }
}

/* базовые фиксы */
html, body{ min-height:100%; }
body{
  min-height:100svh;
  padding-left: var(--safe-left);
  padding-right: var(--safe-right);
}

/* верхний внутренний отступ контейнера (на случай бровей/динамических safe areas) */
.container{
  padding-top: clamp(8px, var(--safe-top), 16px);
  padding-bottom: clamp(8px, var(--safe-bottom), 16px);
}

/* не перекрывать клики декоративными слоями */
.aurora, .blob{ pointer-events:none !important; }

/* карточки */
.budget-page .card{
  background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
  border:1px solid var(--stroke); border-radius:16px; padding:16px; box-shadow:var(--shadow);
}
html[data-theme="light"] .budget-page .card{
  background:linear-gradient(180deg, rgba(0,0,0,.03), rgba(0,0,0,.00));
}

/* заголовок карточки */
.budget-page .card h2{ margin:0; font-size:18px }
.card-head{ display:flex; align-items:center; justify-content:space-between; gap:12px }
.head-between{ display:flex; justify-content:space-between; align-items:center; gap:12px }

/* панель действий внутри секции */
.section-toolbar{ display:flex; justify-content:flex-end; margin:4px 0 12px; gap:10px }

/* +Добавить */
.btn-add{
  display:inline-flex; align-items:center; gap:8px;
  padding:10px 14px; border-radius:14px; font-weight:800;
  background:linear-gradient(135deg, var(--brand), var(--brand2));
  color:#0c0f21; border:0; box-shadow:var(--shadow);
}
.btn-add .plus{ font-size:18px; line-height:1 }
.btn-sm{ padding:6px 10px; font-size:12px; border-radius:10px; }

/* collapsible */
.budget-page .collapsible>summary{
  list-style:none; cursor:pointer; display:flex; align-items:center;
  margin:-4px 0 10px;
}
.budget-page .collapsible>summary::-webkit-details-marker{ display:none }
.budget-page .chev{ display:inline-block; width:1em; height:1em; margin-right:8px; transform-origin:center; transition:transform .25s ease; font-weight:900; color:var(--muted) }
.budget-page .collapsible[open] .chev{ transform:rotate(90deg) }

/* === KPI-блок: не сворачивается, стрелку скрыть === */
.kpi-block > summary{ pointer-events:none; cursor:default; }
.kpi-block > summary .chev{ display:none; }

/* ===== KPI — визуал как «Итоги» на вкладке Инвестиции ===== */
.budget-page .kpis{
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--gap);
  margin: 0 0 var(--gap);
}
.budget-page .kpi{
  background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
  border:1px solid var(--stroke);
  border-radius: var(--radius);
  padding:14px 16px;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  text-align:center;
  box-shadow: var(--shadow);
}
html[data-theme="light"] .budget-page .kpi{
  background:linear-gradient(180deg, rgba(0,0,0,.03), rgba(0,0,0,0));
}
.budget-page .kpi__label{
  font-size: clamp(11px, 1.6vw, 12px);
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: .25px;
  margin-bottom: 6px;
}
.budget-page .kpi__value{
  font-size: clamp(20px, 3vw, 26px);
  font-weight: 800;
  line-height: 1;
}
@media (max-width: 860px){
  .budget-page .kpis{ grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }
}

/* сетки */
.budget-page .grid{ display:grid; gap:16px }
.budget-page .grid--2{ grid-template-columns:1fr }
@media (min-width:960px){ .budget-page .grid--2{ grid-template-columns:1fr 1fr } }

/* формы */
.budget-page .form{ display:grid; gap:12px }
.budget-page .form__row{ display:grid; gap:12px; margin-bottom:12px }
@media (min-width:860px){ .budget-page .form__row{ grid-template-columns:repeat(4,1fr) } }
.budget-page label{ display:flex; flex-direction:column; gap:6px; font-size:13px; color:var(--muted) }
.budget-page input, .budget-page select{
  background:var(--input-bg); border:1px solid var(--stroke); color:var(--text);
  border-radius:12px; padding:10px; font-size:14px; width:100%;
}
.budget-page input::placeholder{ color:#7681a1 }
.budget-page .btn{ font-weight:800 }
.budget-page .btn-primary{ background:linear-gradient(135deg, var(--brand), var(--brand2)); color:#0c0f21; border:1px solid transparent }
.budget-page .btn-danger{
  background:linear-gradient(135deg, #ff6b6b, #f43f5e); color:#fff;
  border:1px solid rgba(255,255,255,.08);
}
.hidden{ display:none !important; }

/* табы */
.budget-page .tabs{ display:flex; gap:10px; flex-wrap:wrap; margin:8px 0 14px }
.budget-page .tab-btn{
  background:var(--input-bg); border:1px solid var(--stroke); color:var(--text);
  padding:8px 12px; border-radius:999px; cursor:pointer; font-weight:800
}
.budget-page .tab-btn--active{
  background:linear-gradient(135deg, var(--brand), var(--brand2)); border:none; color:#0c0f21
}

/* таблицы */
.budget-page .table{ width:100%; border-collapse:collapse; table-layout:fixed; }
.budget-page .table th,.budget-page .table td{
  border-bottom:1px solid var(--stroke); padding:10px; font-size:14px; vertical-align:middle;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.budget-page .table th{ color:var(--muted); font-weight:800 }
.budget-page .t-right{text-align:right} .budget-page .t-center{text-align:center}
.col-date{ width:92px }
.col-sum{ width:130px }

/* колонка «Категория» выравнена по левому краю */
.col-cat, .budget-page th.col-cat{ text-align:left; }

.col-desc{ width:auto }
.cell-clip{ display:block; max-width: clamp(120px, 35vw, 420px); overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

/* строки кликабельны */
.table tbody tr[data-clickrow]{ cursor:pointer; }

/* раскрывашка */
.row-more td{ padding-top:8px; }
.row-more__box{
  background:var(--input-bg); border:1px solid var(--stroke);
  border-radius:10px; padding:10px; font-size:13px; color:var(--muted);
}

/* бейджи типов */
.budget-page .pill{ display:inline-flex; align-items:center; padding:4px 8px; border-radius:999px; font-weight:800; font-size:12px }
.budget-page .pill--inc{ background:#0f5132; color:#b6f7d2; border:1px solid #0b3b24 }
.budget-page .pill--exp{ background:#5a1a1a; color:#ffd6d6; border:1px solid #3d1010 }
.budget-page .pill--tr{ background:#20385b; color:#cfe2ff; border:1px solid #162a46 }

/* графики */
:root{ --chart-h: 280px; }
.budget-page .chart-box{ position:relative; overflow:visible; background:transparent; border:none; border-radius:0; padding:0; }
.budget-page .chart-box canvas{ display:block; width:100% !important; height:var(--chart-h) !important; }

/* регистр вкладок */
.budget-page .ledger{ display:none } .budget-page .ledger.visible{ display:block }

/* ===== ТУМБЛЕР «ГОТОВО» ===== */
.budget-page .chk{
  appearance: none;
  -webkit-appearance: none;
  position: relative;
  cursor: pointer;
  width: var(--ob-toggle-w);
  height: var(--ob-toggle-h);
  border-radius: 999px;
  background: color-mix(in srgb, var(--text) 12%, transparent);
  border: 1px solid var(--stroke);
  box-shadow: inset 0 1px 2px rgba(0,0,0,.15);
  transition: background .18s ease, border-color .18s ease, box-shadow .18s ease;
  outline: none;
  margin: 0 auto;
}
.budget-page .chk::after{
  content:'';
  position:absolute;
  top: var(--ob-toggle-pad);
  left: var(--ob-toggle-pad);
  width: var(--ob-toggle-knob);
  height: var(--ob-toggle-knob);
  border-radius: 50%;
  background: #fff;
  box-shadow: 0 2px 6px rgba(0,0,0,.25);
  transition: transform .18s ease, background .18s ease, box-shadow .18s ease;
  will-change: transform;
}
.budget-page .chk::before{
  content:'';
  position:absolute; inset: 0;
  border-radius: 999px;
  display: grid; place-items: center;
  font-weight: 900; font-size: 14px; color: #0c0f21; opacity: 0;
  transition: opacity .18s ease;
}
.budget-page .chk:checked{
  background: linear-gradient(135deg, var(--ok), color-mix(in srgb, var(--ok) 50%, white));
  border-color: var(--ok);
  box-shadow: inset 0 1px 1px rgba(0,0,0,.06);
}
.budget-page .chk:checked::after{ transform: translateX(var(--ob-toggle-shift)); background:#fff; box-shadow:0 2px 6px rgba(0,0,0,.2) }
.budget-page .chk:checked::before{ content:'✓'; color:#0c0f21; opacity:.95 }
.budget-page .chk:active::after{ box-shadow:0 1px 4px rgba(0,0,0,.25); transform:translateX(0) scale(.96) }
.budget-page .chk:checked:active::after{ transform:translateX(var(--ob-toggle-shift)) scale(.96) }
.budget-page .chk:focus-visible{
  box-shadow:0 0 0 3px color-mix(in srgb, var(--ok) 35%, transparent), inset 0 1px 2px rgba(0,0,0,.12)
}
.budget-page .ob-row.overdue .chk:not(:checked){ background: color-mix(in srgb, var(--accent) 22%, transparent); border-color: var(--accent); }
.budget-page .ob-row.overdue .chk:not(:checked)::after{ background:#ffd3e4 }
.budget-page .ob-row.overdue td:first-child{ color:var(--accent); font-weight:800 }
.budget-page .ob-row.done td:first-child{ color:var(--ok) }
@supports not (color-mix: in srgb, white, black){
  .budget-page .chk{ background: rgba(255,255,255,.08); }
  .budget-page .chk:checked{ background: linear-gradient(135deg, var(--ok), #7ff0d1); }
  .budget-page .ob-row.overdue .chk:not(:checked){ background: rgba(248,106,164,.18); }
}

/* ===== MODAL ===== */
.modal[hidden]{ display:none !important; }
.modal{ display:block !important; position:fixed !important; inset:0 !important; z-index:2147483647 !important; pointer-events:auto !important; }
.modal__backdrop{ position:absolute; inset:0; background:rgba(0,0,0,.45); backdrop-filter: blur(2px); }
.modal__dialog{
  position:relative; z-index:1; margin:10vh auto 6vh; max-width:960px;
  background:var(--dialog-bg, #11182f); border:1px solid var(--stroke); color:var(--text);
  border-radius:16px; box-shadow:var(--shadow-xl); padding:20px; width:calc(100% - 32px);
}
html[data-theme="light"] .modal__dialog{ --dialog-bg:#ffffff }
.modal__header{ display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:12px }
.modal__header h3{ margin:0; font-size:22px }
.modal__close{ border:1px solid var(--stroke); width:34px; height:34px; border-radius:10px; background:var(--input-bg); color:var(--text) }
.modal__footer{ display:flex; justify-content:flex-end; margin-top:8px }

/* сегменты в модалках */
.seg{ display:inline-flex; gap:8px; padding:6px; background:var(--input-bg); border:1px solid var(--stroke); border-radius:12px; margin-bottom:12px }
.seg-btn{ border:0; padding:8px 12px; border-radius:999px; font-weight:800; cursor:pointer; background:transparent; color:var(--text); opacity:.8 }
.seg-btn.is-active{ opacity:1; color:#0c0f21; background:linear-gradient(135deg, var(--brand), var(--brand2)) }

/* ====== Универсальная «корзина» ====== */
.btn-del{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:10px; }
.btn-del .ico{ pointer-events:none }

/* ====== ТАБЛИЦА КАТЕГОРИЙ ====== */
.table--cats{ table-layout:fixed; }
.table--cats .col-actions{ width:120px; }
.table--cats td:last-child, .table--cats th:last-child{ overflow:visible; white-space:nowrap; }

/* iPhone 12 Pro и похожие (узкие экраны) */
@media (max-width: 420px){
  :root{ --chart-h: 220px; }
  .budget-page .grid--2{ grid-template-columns:1fr }
  .t-hide-sm{ display:none }
  .budget-page .table th,.budget-page .table td{ font-size:13px; padding:8px }
  .table--cats .col-actions{ width:84px; }
  .btn-del{ width:36px; height:36px; padding:6px; justify-content:center; }
  .btn-del .txt{ display:none; }
}

/* доп. стиль красной кнопки (в таблицах) */
.btn-danger, .budget-page .btn-danger{ background:#e6536b; border-color:#e6536b; color:#0c0f21; }

/* --- Obligations totals --- */
.table tfoot{ display: table-footer-group !important; }
.table tfoot .row-total td{ padding: 12px 16px; border-top: 1px solid var(--stroke); line-height: 1.4; }
.table tfoot .totals-cell{ text-align: center; color: var(--muted); font-size: 14px; white-space: normal; }
.table tfoot .totals-cell strong{ color: var(--text); font-weight: 800; white-space: nowrap; }
.table tfoot .totals-cell .sep{ margin: 0 10px; opacity: .5; }
.table tfoot .totals-cell .mobile-br{ display:none; }
@media (max-width: 520px){
  .table tfoot .totals-cell{ text-align: left; }
  .table tfoot .totals-cell .mobile-br{ display:block; height:4px; }
  .table tfoot .totals-cell .sep{ display:none; }
}

/* ===== KPI — кнопки у накопительного ===== */
.kpi-actions{ display:flex; gap:8px; margin-top:10px; flex-wrap:wrap; justify-content:center; }
.kpi-btn{
  display:inline-flex; align-items:center; gap:8px; padding:8px 14px; border-radius:999px;
  font-weight:800; border:1px solid var(--stroke); background:var(--input-bg); color:var(--text);
  box-shadow: var(--shadow);
  transition: transform .08s ease, box-shadow .12s ease, background .12s ease, border-color .12s ease;
}
.kpi-btn:hover{ transform: translateY(-1px); box-shadow: var(--shadow-lg, var(--shadow)); }
.kpi-btn:active{ transform: translateY(0); }
.kpi-btn__ico{ display:inline-block; width:1.1em; height:1.1em; line-height:1; font-weight:900; opacity:.9; }
.kpi-btn--primary{ background:linear-gradient(135deg, var(--brand), var(--brand2)); color:#0c0f21; border-color:transparent; }
.kpi-btn--danger{ background:transparent; color:var(--accent); border-color:var(--accent); }
.kpi-btn--danger:hover{ background: color-mix(in srgb, var(--accent) 12%, transparent); }
@supports not (color-mix: in srgb, white, black){ .kpi-btn--danger:hover{ background: rgba(244,63,94,.12); } }
@media (max-width: 420px){ .kpi-actions{ gap:6px } .kpi-btn{ padding:8px 12px } }

/* ===== Фильтры категорий — dropdown ===== */
.filters-row{ display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
.cat-filter{ position:relative; z-index:10; }
.dd{ position:relative; display:inline-block; }
.dd[open] .dd__btn{ box-shadow: var(--shadow-lg, var(--shadow)); transform: translateY(-1px); }
.dd__btn{
  list-style:none; cursor:pointer;
  display:inline-flex; align-items:center; gap:10px;
  padding:8px 14px; border-radius:999px; font-weight:800;
  border:1px solid var(--stroke); background:var(--input-bg); color:var(--text);
  box-shadow: var(--shadow);
  transition: transform .08s ease, box-shadow .12s ease, background .12s ease, border-color .12s ease;
}
.dd__btn::-webkit-details-marker{ display:none }
.dd__btn::after{
  content:""; width:.55rem; height:.55rem;
  border-right:2px solid var(--muted); border-bottom:2px solid var(--muted);
  transform: rotate(45deg); margin-left:2px;
}
.dd__list{
  position:absolute; top:calc(100% + 8px); left:0;
  min-width:220px; max-height:320px; overflow:auto;
  background: var(--dialog-bg, #11182f);
  border:1px solid var(--stroke); border-radius:14px;
  box-shadow: var(--shadow-xl); padding:6px;
}
html[data-theme="light"] .dd__list{ --dialog-bg:#ffffff; }
.dd__opt{
  width:100%; text-align:left; background:transparent; color:var(--text);
  border:0; border-radius:10px; padding:8px 10px; font-weight:700; cursor:pointer;
}
.dd__opt:hover{ background: color-mix(in srgb, var(--brand) 14%, transparent); }
@supports not (color-mix: in srgb, white, black){ .dd__opt:hover{ background: rgba(106,125,255,.14); } }
.dd__opt.is-active{ background: linear-gradient(135deg, var(--brand), var(--brand2)); color:#0c0f21; }
@media (max-width:520px){ .dd__list{ min-width: clamp(220px, 92vw, 480px); } }

/* --- Obligations column sizes --- */
.budget-page .table th.col-done,
.budget-page .table td.col-done,
.budget-page .table th.col-actions,
.budget-page .table td.col-actions{ overflow: visible; }
.budget-page .table th.col-done,
.budget-page .table td.col-done{ width: 80px; text-align:center; }
.budget-page .table th.col-actions,
.budget-page .table td.col-actions{ width: 120px; text-align:right; }
.budget-page .table .btn-del{ padding: 6px 10px; white-space: nowrap; }
.budget-page .chk{ display:block; margin: 0 auto; }
@media (max-width: 420px){
  .budget-page .table th.col-done,
  .budget-page .table td.col-done{ width: 56px; }
  .budget-page .table th.col-actions,
  .budget-page .table td.col-actions{ width: 58px; }
}

/* ===== Toasts ===== */
.toast-wrap{
  position:fixed; right:16px; bottom:16px; z-index:2147483647; display:grid; gap:8px;
}
.toast{
  padding:10px 14px; border-radius:12px; font-weight:800;
  background:linear-gradient(135deg, var(--brand), var(--brand2)); color:#0c0f21;
  box-shadow:var(--shadow-xl);
  transition:opacity .25s ease, transform .25s ease;
}
.toast.err{
  background:linear-gradient(135deg, #ff6b6b, #f43f5e); color:#fff;
}

/* ===== HEADER (фикс налезания) ===== */
:root{ --header-h: 56px; }

/* было с фикс-высотой; делаем авто-высоту и перенос */
.app-header{
  position: static !important;
  display: flex;
  flex-wrap: wrap;              /* ← разрешаем перенос строк */
  align-items: center;
  gap: 8px 12px;
  height: auto !important;      /* ← вместо фиксированной */
  min-height: var(--header-h);  /* минимальная высота как на «Инвестициях» */
  padding: 10px clamp(10px,1.6vw,14px);
  margin-bottom: 22px;          /* ↓ отступ под табы, чтобы точно не касались */
  backdrop-filter: saturate(1.2) blur(6px);
  background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
  border: 1px solid var(--stroke);
  border-radius: clamp(10px,1.8vw,14px);
  box-shadow: var(--shadow);
  z-index: 1;
}

/* делаем блоки внутри шапки адаптивными, чтобы красиво переносились */
.search-wrap{ flex: 1 1 260px; min-width: 260px; max-width: 520px; }
.header-actions{
  flex: 1 1 420px;
  display:flex; flex-wrap:wrap; gap:8px; justify-content:flex-end;
}

/* табы — под шапкой, с небольшим «воздухом» */
.container > .tabs-row{
  position: relative; z-index: 0;
  margin-top: 0;
  padding-top: 2px;
}

@media (max-width: 640px){
  .app-header{ margin-bottom: 26px; }   /* чуть больше воздуха на узких экранах */
}
