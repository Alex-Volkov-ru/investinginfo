<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title id="pageTitle">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</title>

  <script>
    if (!localStorage.getItem('pf_token')) {
      window.location.replace('login.html');
    }
  </script>

  <!-- libs -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/axios@1.7.2/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ru.js"></script>

  <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body>
  <div class="aurora"></div>
  <div class="blob one"></div>
  <div class="blob two"></div>

  <div class="container">
    <header>
      <div class="search-wrap">
        <input id="searchInput" type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Ç–∏–∫–µ—Ä–∞–º/–Ω–∞–∑–≤–∞–Ω–∏—é‚Ä¶" />
      </div>

      <div class="header-actions">
        <button class="btn btn-ghost" id="toggleAllBtn" title="–°–≤–µ—Ä–Ω—É—Ç—å/—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ —Å–µ–∫—Ü–∏–∏">‚§¥Ô∏è –í—Å–µ</button>
        <div id="authStatus" class="auth-status">–ì–æ—Å—Ç—å</div>
        <button id="logoutBtn" class="btn btn-danger" title="–í—ã–π—Ç–∏">üö™ –í—ã–π—Ç–∏</button>
        <button id="refreshBtn" class="btn" title="–û–±–Ω–æ–≤–∏—Ç—å –∫–æ—Ç–∏—Ä–æ–≤–∫–∏">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
        <button id="themeToggle" class="btn" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">üåì –¢–µ–º–∞</button>
        <button id="apiStatusBtn" class="btn" title="–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Tinkoff Invest API">
          üîå <span id="apiStatusDot" style="display:inline-block;width:10px;height:10px;border-radius:50%;background:#888;margin-left:6px;"></span>
        </button>
      </div>
    </header>

    <!-- –¢–∞–±—ã: –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ / –ë—é–¥–∂–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ -->
    <nav class="tabs-row">
      <a class="tab active" href="index.html">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</a>
      <a class="tab" href="budget.html">–ë—é–¥–∂–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
    </nav>

    <div class="portfolio-charts">
      <div class="chart-card animate-in skeleton" id="sk1"><h3>–ê–ª–ª–æ–∫–∞—Ü–∏—è –ø–æ –∫–ª–∞—Å—Å–∞–º</h3><canvas id="chartByClass"></canvas></div>
      <div class="chart-card animate-in skeleton" id="sk2"><h3>–ê–ª–ª–æ–∫–∞—Ü–∏—è –ø–æ —Ç–∏–∫–µ—Ä–∞–º (—Å—Ç–æ–∏–º–æ—Å—Ç—å)</h3><canvas id="chartByTickerValue"></canvas></div>
      <div class="chart-card animate-in skeleton" id="sk3"><h3>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—É–º–∞–≥ –ø–æ —Ç–∏–∫–µ—Ä–∞–º</h3><canvas id="chartByTickerQty"></canvas></div>
    </div>

    <h2 class="zone-title">–ò—Ç–æ–≥–∏</h2>
    <div class="portfolio-summary" id="portfolioSummary"></div>

    <div class="title-row">
      <h2 class="zone-title">–ü–æ–∑–∏—Ü–∏–∏</h2>
      <button id="openAddBtn" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤</button>
    </div>

    <!-- –ù–£–õ–ï–í–û–ï –°–û–°–¢–û–Ø–ù–ò–ï (–∫–æ–≥–¥–∞ –Ω–µ—Ç –ø–æ–∑–∏—Ü–∏–π) -->
    <div id="emptyState" class="empty-state hidden" aria-live="polite">
      <div class="empty-card">
        <h3>–ó–¥–µ—Å—å –±—É–¥—É—Ç –≤–∞—à–∏ –∞–∫—Ç–∏–≤—ã</h3>
        <p class="muted">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –ø–æ–∑–∏—Ü–∏—é –∏–ª–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å—á—ë—Ç–∞.</p>
        <div class="empty-actions">
          <button id="emptyAddBtn" class="btn btn-primary">Ôºã –î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤</button>
        </div>
      </div>
    </div>

    <div id="portfolioSections"></div>
  </div>

  <!-- Toasts -->
  <div class="toast-wrap" id="toastWrap"></div>

  <!-- FAB (–º–æ–±–∏–ª–∫–∞) -->
  <button id="fabAddBtn" class="fab" title="–î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤">Ôºã</button>

  <!-- –ú–æ–¥–∞–ª–∫–∞: –û–ù–ë–û–†–î–ò–ù–ì (–æ–¥–∏–Ω —Ä–∞–∑, —Å —á–µ–∫–±–æ–∫—Å–æ–º "–Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å") -->
  <div id="onboardingModal" class="modal" aria-hidden="true">
    <div class="modal__dialog">
      <div class="modal__header">
        <h3>–ö–∞–∫ –Ω–∞—á–∞—Ç—å</h3>
        <button class="modal__close" id="onbCloseX" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>
      <div class="form-grid">
        <div class="readonly-box">
          <ol>
            <li>–ù–∞–∂–º–∏—Ç–µ ¬´–î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤¬ª –∏ –≤–Ω–µ—Å–∏—Ç–µ –ø–µ—Ä–≤—É—é —Å–¥–µ–ª–∫—É (–∏–ª–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞–∫–æ–ø–∏—Ç. —Å—á—ë—Ç–∞).</li>
            <li>–ù–∞–∂–º–∏—Ç–µ ¬´–û–±–Ω–æ–≤–∏—Ç—å¬ª ‚Äî –ø–æ–¥—Ç—è–Ω–µ–º FIGI –∏ –∫–æ—Ç–∏—Ä–æ–≤–∫–∏, –ø–æ—è–≤—è—Ç—Å—è –≥—Ä–∞—Ñ–∏–∫–∏.</li>
            <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–∏—Å–∫ –∏ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–π –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –ø–æ—Ä—Ç—Ñ–µ–ª—é.</li>
          </ol>
          <label class="checkbox-row" style="margin-top:8px">
            <input id="onbDontShow" type="checkbox" /> –ë–æ–ª—å—à–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å
          </label>
        </div>
      </div>
      <div class="modal__footer">
        <button id="onbCloseBtn" class="btn btn-primary">–ü–æ–Ω—è—Ç–Ω–æ</button>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞: –î–û–ë–ê–í–ò–¢–¨ –ê–ö–¢–ò–í -->
  <div id="addModal" class="modal" aria-hidden="true">
    <div class="modal__dialog">
      <div class="modal__header">
        <h3>–î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤</h3>
        <button class="modal__close" id="addCloseX" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>

      <form id="assetForm">
        <div class="form-grid">
          <div class="form-group">
            <label for="assetType">–¢–∏–ø –∞–∫—Ç–∏–≤–∞</label>
            <div class="select-wrap">
              <select id="assetType" required>
                <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                <option value="stock">–ê–∫—Ü–∏—è</option>
                <option value="bond">–û–§–ó/–û–±–ª–∏–≥–∞—Ü–∏—è</option>
                <option value="fund">–§–æ–Ω–¥/ETF</option>
                <option value="savings">–ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π —Å—á—ë—Ç</option>
              </select>
            </div>
          </div>

          <div class="form-group" id="fieldName">
            <label for="assetName">–¢–∏–∫–µ—Ä / –ù–∞–∑–≤–∞–Ω–∏–µ</label>
            <input type="text" id="assetName" placeholder="SBER, YNDX, TGLD" />
          </div>

          <div class="form-group" id="fieldQuantity">
            <label for="assetQuantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
            <input type="number" id="assetQuantity" min="0" step="1" placeholder="–ù–∞–ø—Ä.: 10" />
          </div>

          <div class="form-group" id="fieldPrice">
            <label for="assetAvgPrice">–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏ (‚ÇΩ)</label>
            <input type="number" id="assetAvgPrice" step="0.0001" min="0" placeholder="–ù–∞–ø—Ä.: 4383" />
          </div>

          <div class="form-group" id="fieldSavingsAmount" style="display:none;">
            <label for="savingsAmount">–°—É–º–º–∞ (‚ÇΩ)</label>
            <input type="number" id="savingsAmount" min="0" step="0.01" placeholder="–ù–∞–ø—Ä.: 100000" />
          </div>

          <div class="form-group" id="fieldDate">
            <label for="assetDate">–î–∞—Ç–∞ –ø–æ–∫—É–ø–∫–∏/–≤–Ω–µ—Å–µ–Ω–∏—è</label>
            <input type="text" id="assetDate" placeholder="–¥–¥.–º–º.–≥–≥–≥–≥" />
          </div>
        </div>

        <div class="modal__footer">
          <button id="addCloseBtn" type="button" class="btn btn-ghost">–û—Ç–º–µ–Ω–∞</button>
          <button type="submit" class="btn btn-primary" id="addBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
      </form>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞: –ò–ó–ú–ï–ù–ò–¢–¨ -->
  <div id="editModal" class="modal" aria-hidden="true">
    <div class="modal__dialog">
      <div class="modal__header">
        <h3 id="editTitle">–ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é</h3>
        <button class="modal__close" id="editCancelX" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>
      <div class="form-grid">
        <div class="form-group">
          <label>FIGI</label>
          <div id="editFigi" class="readonly-box">‚Äî</div>
        </div>
        <div class="form-group">
          <label for="editDeltaQty">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (Œî)</label>
          <input id="editDeltaQty" type="number" placeholder="+/- —à—Ç. (–ø–æ–∫—É–ø–∫–∞ = +, –ø—Ä–æ–¥–∞–∂–∞ = -)" />
        </div>
        <div class="form-group">
          <label for="editPrice">–¶–µ–Ω–∞ —Å–¥–µ–ª–∫–∏</label>
          <input id="editPrice" type="number" step="0.0001" placeholder="–¶–µ–Ω–∞ –∑–∞ 1 —à—Ç." />
        </div>
        <div class="form-group">
          <label for="editDate">–î–∞—Ç–∞ —Å–¥–µ–ª–∫–∏</label>
          <input id="editDate" type="text" placeholder="–¥–¥.–º–º.–≥–≥–≥–≥" />
        </div>
      </div>
      <div class="modal__footer">
        <button id="editCancelBtn" class="btn btn-ghost">–û—Ç–º–µ–Ω–∞</button>
        <button id="editSaveBtn" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞: –¢–û–ö–ï–ù -->
  <div id="tokenModal" class="modal" aria-hidden="true">
    <div class="modal__dialog">
      <div class="modal__header">
        <h3>–¢–æ–∫–µ–Ω –¢–∏–Ω—å–∫–æ—Ñ—Ñ</h3>
        <button class="modal__close" id="modalCancelX" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>
      <p class="muted">–¢–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º —Ä—ã–Ω–∫–∞.</p>
      <label for="modalTinkoffToken">–ù–æ–≤—ã–π —Ç–æ–∫–µ–Ω</label>
      <input id="modalTinkoffToken" type="password" placeholder="t.xxxxx" />
      <div class="modal__footer">
        <button id="modalCancelBtn" class="btn btn-ghost">–û—Ç–º–µ–Ω–∞</button>
        <button id="modalClearBtn" class="btn btn-danger">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <button id="modalSaveBtn" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <script defer src="assets/js/script.js"></script>
</body>
</html>
