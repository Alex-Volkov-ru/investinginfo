<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title id="pageTitle">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</title>

  <script>
    if (!localStorage.getItem('pf_token')) {
      window.location.replace('login.html');
    }
    // Initialize theme
    document.documentElement.setAttribute('data-theme', localStorage.getItem('pf_theme') || 'dark');
  </script>

  <!-- Critical CSS - –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É -->
  <link rel="stylesheet" href="assets/css/critical.css" />
  
  <!-- Non-critical resources - –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ -->
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap"></noscript>
  
  <script src="https://cdn.jsdelivr.net/npm/axios@1.7.2/dist/axios.min.js"></script>
  
  <!-- Chart.js –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  
  <!-- Flatpickr –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ -->
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"></noscript>
  
  <script>
    window.loadFlatpickr = function() {
      return new Promise((resolve) => {
        if (window.flatpickr) { resolve(); return; }
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/flatpickr';
        script.onload = () => {
          const ruScript = document.createElement('script');
          ruScript.src = 'https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ru.js';
          ruScript.onload = resolve;
          document.head.appendChild(ruScript);
        };
        document.head.appendChild(script);
      });
    };
  </script>
  
  <link rel="preload" href="assets/css/style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="assets/css/style.css"></noscript>

  <!-- –ú–æ–±–∏–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ -->
  <meta name="theme-color" content="#4361ee">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
</head>
<body>
  <div class="aurora"></div>
  <div class="blob one"></div>
  <div class="blob two"></div>

  <div class="container">
    <header>
      <div class="search-wrap">
        <input id="searchInput" type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Ç–∏–∫–µ—Ä–∞–º/–Ω–∞–∑–≤–∞–Ω–∏—é‚Ä¶" title="–ò—Å–∫–∞—Ç—å –ø–æ —Ç–∏–∫–µ—Ä—É –∏ –Ω–∞–∑–≤–∞–Ω–∏—é (/)"/>
      </div>

      <div class="header-actions">
        <button class="btn btn-ghost" id="toggleAllBtn" title="–°–≤–µ—Ä–Ω—É—Ç—å/—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ —Å–µ–∫—Ü–∏–∏ (S)">‚§¥Ô∏è –í—Å–µ</button>
        <div id="authStatus" class="auth-status">–ì–æ—Å—Ç—å</div>
        <button id="logoutBtn" class="btn btn-danger" title="–í—ã–π—Ç–∏">üö™ –í—ã–π—Ç–∏</button>
        <button id="refreshBtn" class="btn" title="–û–±–Ω–æ–≤–∏—Ç—å –∫–æ—Ç–∏—Ä–æ–≤–∫–∏ (R)">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
        <button id="themeToggle" class="btn" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É (T)">üåì –¢–µ–º–∞</button>
        <button id="apiStatusBtn" class="btn" title="–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Tinkoff Invest API">
          üîå <span id="apiStatusDot" style="display:inline-block;width:10px;height:10px;border-radius:50%;background:#888;margin-left:6px;"></span>
        </button>
        <button id="helpBtn" class="btn" title="–°–ø—Ä–∞–≤–∫–∞ (?)">‚ùì –°–ø—Ä–∞–≤–∫–∞</button>
      </div>
    </header>

    <!-- –¢–∞–±—ã -->
    <nav class="tabs-row">
      <a class="tab active" href="index.html">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</a>
      <a class="tab" href="budget.html">–ë—é–¥–∂–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
      <a class="tab" href="obligations.html">–û–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞</a>
    </nav>

    <div class="portfolio-charts">
      <div class="chart-card animate-in skeleton" id="sk1"><h3>–ê–ª–ª–æ–∫–∞—Ü–∏—è –ø–æ –∫–ª–∞—Å—Å–∞–º</h3><canvas id="chartByClass"></canvas></div>
      <div class="chart-card animate-in skeleton" id="sk2"><h3>–ê–ª–ª–æ–∫–∞—Ü–∏—è –ø–æ —Ç–∏–∫–µ—Ä–∞–º (—Å—Ç–æ–∏–º–æ—Å—Ç—å)</h3><canvas id="chartByTickerValue"></canvas></div>
      <div class="chart-card animate-in skeleton" id="sk3"><h3>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—É–º–∞–≥ –ø–æ —Ç–∏–∫–µ—Ä–∞–º</h3><canvas id="chartByTickerQty"></canvas></div>
    </div>

    <h2 class="zone-title">–ò—Ç–æ–≥–∏</h2>
    <div class="portfolio-summary" id="portfolioSummary"></div>

    <div class="title-row">
      <h2 class="zone-title">–ü–æ–∑–∏—Ü–∏–∏</h2>
      <button id="openAddBtn" class="btn btn-primary" title="–î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤ (A)">–î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤</button>
    </div>

    <!-- –ù—É–ª–µ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
    <div id="emptyState" class="empty-state hidden">
      <div class="empty-card">
        <h3>–ö–∞–∫ –Ω–∞—á–∞—Ç—å</h3>
        <ol class="muted">
          <li>–ù–∞–∂–º–∏—Ç–µ <b>¬´–î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤¬ª</b> –∏ –≤–Ω–µ—Å–∏—Ç–µ –ø–µ—Ä–≤—É—é —Å–¥–µ–ª–∫—É.</li>
          <li>–ù–∞–∂–º–∏—Ç–µ <b>¬´–û–±–Ω–æ–≤–∏—Ç—å¬ª</b> ‚Äî –ø–æ–¥—Ç—è–Ω–µ–º FIGI –∏ –∫–æ—Ç–∏—Ä–æ–≤–∫–∏, –ø–æ—è–≤—è—Ç—Å—è –≥—Ä–∞—Ñ–∏–∫–∏.</li>
          <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ <b>–ø–æ–∏—Å–∫</b> –∏ <b>—Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–π</b> –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.</li>
        </ol>
        <div class="empty-actions">
          <button class="btn btn-primary" id="emptyAddBtn">–î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤</button>
          <button class="btn" id="helpOpenSecondary">–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É</button>
        </div>
      </div>
    </div>

    <div id="portfolioSections"></div>
  </div>

  <!-- Toasts -->
  <div class="toast-wrap" id="toastWrap"></div>

  <!-- FAB (–º–æ–±–∏–ª–∫–∞) -->
  <button id="fabAddBtn" class="fab" title="–î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤ (A)">Ôºã</button>

  <!-- –ú–æ–¥–∞–ª–∫–∞: –î–û–ë–ê–í–ò–¢–¨ –ê–ö–¢–ò–í -->
  <div id="addModal" class="modal" aria-hidden="true">
    <div class="modal__dialog">
      <div class="modal__header">
        <h3>–î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤</h3>
        <button class="modal__close" id="addCloseX" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>

      <form id="assetForm">
        <div class="form-grid">
          <div class="form-group">
            <label for="assetType">–¢–∏–ø –∞–∫—Ç–∏–≤–∞</label>
            <div class="select-wrap">
              <select id="assetType" required>
                <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                <option value="stock">–ê–∫—Ü–∏—è</option>
                <option value="bond">–û–§–ó/–û–±–ª–∏–≥–∞—Ü–∏—è</option>
                <option value="fund">–§–æ–Ω–¥/ETF</option>
              </select>
            </div>
          </div>

          <div class="form-group" id="fieldName">
            <label for="assetName">–¢–∏–∫–µ—Ä / –ù–∞–∑–≤–∞–Ω–∏–µ</label>
            <input type="text" id="assetName" placeholder="SBER, YNDX, TGLD" />
          </div>

          <div class="form-group" id="fieldQuantity">
            <label for="assetQuantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
            <input type="number" id="assetQuantity" min="0" step="1" placeholder="–ù–∞–ø—Ä.: 10" />
          </div>

          <div class="form-group" id="fieldPrice">
            <label for="assetAvgPrice">–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏ (‚ÇΩ)</label>
            <input type="number" id="assetAvgPrice" step="0.0001" min="0" placeholder="–ù–∞–ø—Ä.: 4383" />
          </div>

          <div class="form-group" id="fieldDate">
            <label for="assetDate">–î–∞—Ç–∞ –ø–æ–∫—É–ø–∫–∏</label>
            <input type="text" id="assetDate" placeholder="–¥–¥.–º–º.–≥–≥–≥–≥" />
          </div>
        </div>

        <div class="modal__footer">
          <button id="addCloseBtn" type="button" class="btn btn-ghost">–û—Ç–º–µ–Ω–∞</button>
          <button type="submit" class="btn btn-primary" id="addBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
      </form>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞: –ò–ó–ú–ï–ù–ò–¢–¨ -->
  <div id="editModal" class="modal" aria-hidden="true">
    <div class="modal__dialog">
      <div class="modal__header">
        <h3 id="editTitle">–ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é</h3>
        <button class="modal__close" id="editCancelX" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>
      <div class="form-grid">
        <div class="form-group">
          <label>FIGI</label>
          <div id="editFigi" class="readonly-box">‚Äî</div>
        </div>
        <div class="form-group">
          <label for="editDeltaQty">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (Œî)</label>
          <input id="editDeltaQty" type="number" placeholder="+/- —à—Ç. (–ø–æ–∫—É–ø–∫–∞ = +, –ø—Ä–æ–¥–∞–∂–∞ = -)" />
        </div>
        <div class="form-group">
          <label for="editPrice">–¶–µ–Ω–∞ —Å–¥–µ–ª–∫–∏</label>
          <input id="editPrice" type="number" step="0.0001" placeholder="–¶–µ–Ω–∞ –∑–∞ 1 —à—Ç." />
        </div>
        <div class="form-group">
          <label for="editDate">–î–∞—Ç–∞ —Å–¥–µ–ª–∫–∏</label>
          <input id="editDate" type="text" placeholder="–¥–¥.–º–º.–≥–≥–≥–≥" />
        </div>
      </div>
      <div class="modal__footer">
        <button id="editCancelBtn" class="btn btn-ghost">–û—Ç–º–µ–Ω–∞</button>
        <button id="editSaveBtn" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞: –¢–û–ö–ï–ù -->
  <div id="tokenModal" class="modal" aria-hidden="true">
    <div class="modal__dialog">
      <div class="modal__header">
        <h3>–¢–æ–∫–µ–Ω –¢–∏–Ω—å–∫–æ—Ñ—Ñ</h3>
        <button class="modal__close" id="modalCancelX" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>
      <p class="muted">–¢–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º —Ä—ã–Ω–∫–∞.</p>
      <label for="modalTinkoffToken">–ù–æ–≤—ã–π —Ç–æ–∫–µ–Ω</label>
      <input id="modalTinkoffToken" type="password" placeholder="t.xxxxx" />
      <div class="modal__footer">
        <button id="modalCancelBtn" class="btn btn-ghost">–û—Ç–º–µ–Ω–∞</button>
        <button id="modalClearBtn" class="btn btn-danger">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <button id="modalSaveBtn" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞: –°–ü–†–ê–í–ö–ê -->
  <div id="helpModal" class="modal" aria-hidden="true">
    <div class="modal__dialog">
      <div class="modal__header">
        <h3>–°–ø—Ä–∞–≤–∫–∞ –∏ –≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏</h3>
        <button class="modal__close" id="helpCloseX" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>
      <div class="modal__body">
        <ul class="help-list">
          <li><b>–ü–æ–∏—Å–∫</b> ‚Äî –ø–æ —Ç–∏–∫–µ—Ä—É –∏ –Ω–∞–∑–≤–∞–Ω–∏—é. –ö–ª–∞–≤–∏—à–∞ <span class="kbd">/</span>.</li>
          <li><b>–í—Å–µ</b> ‚Äî —Å–≤–µ—Ä–Ω—É—Ç—å/—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Å–µ–∫—Ü–∏–∏. –ö–ª–∞–≤–∏—à–∞ <span class="kbd">S</span>.</li>
          <li><b>–û–±–Ω–æ–≤–∏—Ç—å</b> ‚Äî –ø–æ–¥—Ç—è–Ω—É—Ç—å –∫–æ—Ç–∏—Ä–æ–≤–∫–∏ –∏ FIGI. –ö–ª–∞–≤–∏—à–∞ <span class="kbd">R</span>.</li>
          <li><b>–¢–µ–º–∞</b> ‚Äî —Ç—ë–º–Ω–∞—è/—Å–≤–µ—Ç–ª–∞—è. –ö–ª–∞–≤–∏—à–∞ <span class="kbd">T</span>.</li>
          <li><b>–î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤</b> ‚Äî –º–æ–¥–∞–ª–∫–∞ –≤–≤–æ–¥–∞ —Å–¥–µ–ª–∫–∏. –ö–ª–∞–≤–∏—à–∞ <span class="kbd">A</span>.</li>
          <li><b>API –¢–∏–Ω—å–∫–æ—Ñ—Ñ</b> ‚Äî –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω.</li>
        </ul>
      </div>
      <div class="modal__footer">
        <button id="helpCloseBtn" class="btn btn-primary">–ü–æ–Ω—è—Ç–Ω–æ</button>
      </div>
    </div>
  </div>

  <script src="assets/js/network-optimizer.js"></script>
  <script defer src="assets/js/script.js"></script>
</body>
</html>
