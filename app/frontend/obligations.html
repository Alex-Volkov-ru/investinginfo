<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Обязательства • Портфель</title>

  <script>
    if (!localStorage.getItem('pf_token')) {
      window.location.replace('login.html');
    }
    // Initialize theme
    document.documentElement.setAttribute('data-theme', localStorage.getItem('pf_theme') || 'dark');
  </script>

  <!-- Critical CSS -->
  <link rel="stylesheet" href="assets/css/critical.css" />
  
  <!-- Non-critical resources -->
  <link rel="preload" href="assets/css/style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <link rel="preload" href="assets/css/obligations.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript>
    <link rel="stylesheet" href="assets/css/style.css" />
    <link rel="stylesheet" href="assets/css/obligations.css" />
  </noscript>

  <!-- Мобильные оптимизации -->
  <meta name="theme-color" content="#4361ee">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body>
  <div class="aurora"></div>
  <div class="blob one"></div>
  <div class="blob two"></div>

  <div class="container">
    <header class="app-header">
      <div class="search-wrap">
        <input id="searchInput" type="search" placeholder="Поиск по названию/описанию…" />
      </div>

      <div class="header-actions">
        <button id="refreshBtn" class="btn" title="Обновить данные (R)">
          <span class="icon icon-refresh"></span>
          Обновить
        </button>
        <button id="themeToggle" class="btn" title="Тёмная/светлая тема (T)">
          <span class="icon icon-theme"></span>
          Тема
        </button>
        <div id="authStatus" class="auth-status">Гость</div>
        <button id="logoutBtn" class="btn btn-danger" title="Выйти из аккаунта">
          <span class="icon icon-logout"></span>
          Выйти
        </button>
        <button id="helpBtn" class="btn" title="Справка и горячие клавиши (?)">
          <span class="icon icon-help"></span>
          Справка
        </button>
      </div>
    </header>

    <!-- Плашки с итогами -->
    <section class="totals-section">
      <h2 class="section-title">ИТОГИ</h2>
      <div class="totals-grid">
        <div class="total-card">
          <div class="total-label">ВСЕГО</div>
          <div class="total-value" id="totalAll">0 ₽</div>
        </div>
        <div class="total-card">
          <div class="total-label">КРЕДИТЫ</div>
          <div class="total-value" id="totalCredits">0 ₽</div>
        </div>
        <div class="total-card">
          <div class="total-label">ОПЛАЧЕНО</div>
          <div class="total-value" id="totalPaid">0 ₽</div>
        </div>
        <div class="total-card">
          <div class="total-label">ОСТАЛОСЬ</div>
          <div class="total-value" id="totalRemaining">0 ₽</div>
        </div>
      </div>
    </section>

    <nav class="tabs-row">
      <a class="tab" href="index.html">Инвестиции</a>
      <a class="tab" href="budget.html">Бюджетирование</a>
      <a class="tab active" href="obligations.html" aria-current="page">Обязательства</a>
    </nav>

    <div class="title-row" style="margin-top:6px;">
      <div class="muted">▸</div>
      <button id="toggleAllBtn" class="btn btn-ghost" title="Развернуть/свернуть все секции (S)">
        <span class="icon icon-compact"></span>
        Все
      </button>
    </div>

    <!-- Мои обязательства -->
    <section class="section open" id="obSection">
      <div class="section-header">
        <button class="section-toggle" data-action="toggle-section" data-section="obSection">
          <span class="chev">▸</span> Мои обязательства
        </button>
        <div class="section-meta">
          <button id="addObBtn" class="btn btn-primary">➕ Добавить обязательство</button>
        </div>
      </div>
      <div class="section-body">
        <div id="obList" class="ob-list"></div>
        <div id="obEmpty" class="empty-state" style="display:none">
          Пока пусто. Нажми «Добавить обязательство».
        </div>
      </div>
    </section>
  </div>

  <!-- Toasts -->
  <div class="toast-wrap" id="toastWrap"></div>

  <!-- Справка / хоткеи -->
  <div class="modal" id="helpModal">
    <div class="modal__dialog" role="dialog" aria-modal="true" aria-labelledby="helpTitle">
      <div class="modal__header">
        <h3 id="helpTitle">Справка и горячие клавиши</h3>
        <button class="modal__close" id="helpCloseX" aria-label="Закрыть">✕</button>
      </div>
      <div class="modal__content">
        <ul class="help-list">
          <li><span class="kbd">/</span> — фокус на поиск</li>
          <li><span class="kbd">R</span> — обновить данные</li>
          <li><span class="kbd">T</span> — переключить тему</li>
          <li><span class="kbd">S</span> — развернуть/свернуть все секции</li>
          <li><span class="kbd">?</span> — открыть эту справку</li>
        </ul>
      </div>
      <div class="modal__footer">
        <button id="helpCloseBtn" class="btn btn-primary">Понятно</button>
      </div>
    </div>
  </div>

  <!-- Модалка «Новое обязательство» -->
  <div class="modal" id="createObModal">
    <div class="modal__dialog" role="dialog" aria-modal="true" aria-labelledby="createTitle">
      <div class="modal__header">
        <h3 id="createTitle">Новое обязательство</h3>
        <button class="modal__close" id="createCloseX" aria-label="Закрыть">✕</button>
      </div>
      <div class="modal__content">
        <label class="label">Название</label>
        <input id="createNameInput" class="input" type="text" placeholder="Например: Кредит наличными" />
      </div>
      <div class="modal__footer">
        <button id="createCancelBtn" class="btn">Отмена</button>
        <button id="createCreateBtn" class="btn btn-primary">Создать</button>
      </div>
    </div>
  </div>

  <!-- Modal: Переименовать -->
<div class="ob-modal" id="renameObModal">
    <div class="ob-modal__dialog">
      <div class="ob-modal__header">
        <div>Переименовать обязательство</div>
        <button class="ob-modal__close" id="renameCloseX">✕</button>
      </div>
      <div class="ob-modal__content">
        <label>Новое название</label>
        <input class="input" id="renameNameInput" placeholder="Например: Кредит наличными" />
      </div>
      <div class="ob-modal__footer">
        <button class="btn btn-ghost" id="renameCancelBtn">Отмена</button>
        <button class="btn" id="renameOkBtn">Сохранить</button>
      </div>
    </div>
  </div>
  
  <!-- Modal: Подтверждение удаления -->
  <div class="ob-modal" id="confirmObModal">
    <div class="ob-modal__dialog">
      <div class="ob-modal__header">
        <div>Подтверждение</div>
        <button class="ob-modal__close" id="confirmCloseX">✕</button>
      </div>
      <div class="ob-modal__content" id="confirmText">Удалить блок?</div>
      <div class="ob-modal__footer">
        <button class="btn btn-ghost" id="confirmCancelBtn">Отмена</button>
        <button class="btn btn-danger" id="confirmOkBtn">Удалить</button>
      </div>
    </div>
  </div>

  <!-- Кнопка компактного режима -->
  <button id="compactToggle" title="Компактный режим">
    <span class="icon icon-compact"></span>
  </button>

  <script src="https://cdn.jsdelivr.net/npm/axios@1.6.8/dist/axios.min.js"></script>
  <script src="assets/js/network-optimizer.js"></script>
  <script src="assets/js/obligations.js"></script>
</body>
</html>
